---
- hosts: vagrant
  vars_files:
    - vars.yml
  gather_facts: false
  become: true
  become_method: sudo

  roles:
    - common
    - nginx
    - postgresql
    - project_data
{%- if cookiecutter.add_celery.lower() == 'y' %}
    - redis
    - celery
{%- else %}
    # - redis
    # - celery
{%- endif %}
{%- if cookiecutter.add_frontend_deployment.lower() == 'y' %}
    - nodejs
    - frontend
{%- else %}
    # - nodejs
    # - frontend
{%- endif %}

#= Dev
#===================================================
- hosts: dev
  vars_files:
    - vars.yml
  gather_facts: false
  become: true
  become_method: sudo

  roles:
    - common
    - nginx
    - postgresql
    - project_data
{%- if cookiecutter.add_celery.lower() == 'y' %}
    - redis
    - celery
{%- else %}
    # - redis
    # - celery
{%- endif %}
{%- if cookiecutter.add_frontend_deployment.lower() == 'y' %}
    - nodejs
    - frontend
{%- else %}
    # - nodejs
    # - frontend
{%- endif %}

#= QA
#===================================================
- hosts: qa
  vars_files:
    - vars.yml
  gather_facts: false
  become: true
  become_method: sudo

  roles:
    - common
    - nginx
    - project_data
    - postgresql
{%- if cookiecutter.add_celery.lower() == 'y' %}
    - redis
    - celery
{%- else %}
    # - redis
    # - celery
{%- endif %}
{%- if cookiecutter.add_frontend_deployment.lower() == 'y' %}
    - nodejs
    - frontend
{%- else %}
    # - nodejs
    # - frontend
{%- endif %}

#= Production
#===================================================
- hosts: production
  vars_files:
    - vars.yml
  gather_facts: false
  become: true
  become_method: sudo

  roles:
    - common
    - nginx
    - project_data
{%- if cookiecutter.add_celery.lower() == 'y' %}
    - redis
    - celery
{%- else %}
    # - redis
    # - celery
{%- endif %}
{%- if cookiecutter.add_frontend_deployment.lower() == 'y' %}
    - nodejs
    - frontend
{%- else %}
    # - nodejs
    # - frontend
{%- endif %}
